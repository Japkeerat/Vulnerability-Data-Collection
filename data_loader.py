import logging
from multiprocessing import Queue

import pandas as pd


class NVDDataLoader:
    def __init__(self, loading_queue: Queue, transformation_completion_flag: bool):
        self.loading_queue = loading_queue
        self.transformation_completion_flag = transformation_completion_flag
        self.list_of_records = list()
    
    def prepare_data(self, data: tuple):
        self.list_of_records.append(data)
    
    def load_data(self):
        while not self.transformation_completion_flag and not self.loading_queue.empty():
            data = self.loading_queue.get()
            self.prepare_data(data)
        df = pd.DataFrame(self.list_of_records, columns=["cve_id", "cwe_id", "cpe_id", "description"])
        df.to_csv("data/cve_data.csv", index=False)